<!DOCTYPE html>
<html>
<head>
<title>Imacge</title>
<script src="hmac-sha1.js"></script>
<script type="text/javascript" src="js/db.js"></script>
<link rel="stylesheet" href="style/index.css"/>
  <style>
  html {
    height: 100%;
    width: 100%;
    overflow: hidden;
  }
  body {
    width: 100%;
    height: 100%;
    margin: 0;
    overflow: auto;
    -webkit-user-select: none;
    font-family: -apple-system-font, sans-serif;
  }
  .top {
     width: 100%;
     height: 200px;
     background-color: gray;
     float: left;
  }
  #drop {
      margin: 0px;
      padding: 0px;
      width: 280px;
      height: 160px;
      margin: auto;
      margin-top: 20px;
      border: 2px dashed white;
      text-align: center;
      background-color: transparent;
      line-height: 160px;
      outline: none;
      display: block;
      color: white;
      cursor: pointer !important;
  }

  </style>
  <meta charset="UTF-8">
</head>
<body>
    <div class="pace  pace-inactive" id="progress">
            <div class="progress" id="progressbar"></div>
            <div class="pace-activity" id="pace-activity"></div>
    </div>

    <div class="top">
        <div id="drop">
            Drop a image here!
        </div>
    </div>

    <input type="text" value="" id="url" />
    <input type="text" value="" id="base64" />
<script>
var qiniuToken = {
    config: {
        access_key : '',
        secret_key : '',
        scope: ''
    },

    getFlags: function () {
        var linuxTime = 3600 + Math.floor(Date.now() / 1000);
        var flags = {"scope": this.config.scope, "deadline": linuxTime};
        return flags;
    },
    byteArrayToString: function (byteArray) {
       var string = '', l = byteArray.length, i;
       for (i = 0; i < l; i++) {
           string += String.fromCharCode(byteArray[i]);
       }
       return string;
   },

    urlsafeBase64EncodeFlag: function () {
        return this.base64_encode(JSON.stringify(this.getFlags()));
    },

    wordsToByteArray:function(words) {
      var bytes = [], i;
      for (i = 0; i < words.length * 32; i += 8) {
          bytes.push((words[i >>> 5] >>> (24 - i % 32)) & 0xFF);
      }
      return bytes;
    },

    base64ToUrlSafe:function(v) {
        return v.replace(/\//g, '_').replace(/\+/g, '-');
    },

    getToken: function () {
        var encodedFlags = this.urlsafeBase64EncodeFlag();
        var hmac = CryptoJS.algo.HMAC.create(CryptoJS.algo.SHA1, this.config.secret_key);
        hmac.update(encodedFlags);
        var words = hmac.finalize().words;
        var base64str = this.base64_encode(this.byteArrayToString(this.wordsToByteArray(words)));
        var encodedSign = this.base64ToUrlSafe(base64str);
        var uploadToken = this.config.access_key + ':' + encodedSign + ':' + encodedFlags;
        return uploadToken;
    },


    byteArrayToString: function(byteArray) {
          var string = '', l = byteArray.length, i;
          for (i = 0; i < l; i++) {
              string += String.fromCharCode(byteArray[i]);
          }
          return string;
    },

    base64_encode: function(str){
        var c1, c2, c3;
        var base64EncodeChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
        var i = 0, len= str.length, string = '';

        while (i < len){
                c1 = str.charCodeAt(i++) & 0xff;
                if (i == len){
                        string += base64EncodeChars.charAt(c1 >> 2);
                        string += base64EncodeChars.charAt((c1 & 0x3) << 4);
                        string += "==";
                        break;
                }
                c2 = str.charCodeAt(i++);
                if (i == len){
                        string += base64EncodeChars.charAt(c1 >> 2);
                        string += base64EncodeChars.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
                        string += base64EncodeChars.charAt((c2 & 0xF) << 2);
                        string += "=";
                        break;
                }
                c3 = str.charCodeAt(i++);
                string += base64EncodeChars.charAt(c1 >> 2);
                string += base64EncodeChars.charAt(((c1 & 0x3) << 4) | ((c2 & 0xF0) >> 4));
                string += base64EncodeChars.charAt(((c2 & 0xF) << 2) | ((c3 & 0xC0) >> 6));
                string += base64EncodeChars.charAt(c3 & 0x3F);
        }
        return string;
    }

};

qiniuToken.config.access_key = '004mJyNuXdOSW3-8_6yv6-e0Z4zTI5VCRhoeALlT';
qiniuToken.config.secret_key = 'nNb-Yvs9YJzHt6lIVIz2M-qPDBMyT82ZEoncSngn';
qiniuToken.config.scope = 'kamisama';

</script>
    <script type="text/javascript" src="lib/qiniu.min.js"></script>
    <script type="text/javascript" src="js/plupload/plupload.full.min.js"></script>
    <script type="text/javascript" src="js/plupload/i18n/zh_CN.js"></script>
    <script type="text/javascript" src="js/imacge.js"></script>
</body>
</html>
